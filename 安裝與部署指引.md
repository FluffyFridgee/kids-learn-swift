# 遊戲平台專案 - 完整安裝與部署指引

## 前置需求安裝

### 步驟 1：安裝 Node.js（包含 npm）

1. **下載 Node.js**
   - 訪問：https://nodejs.org/
   - 下載 LTS 版本（推薦 v18 或 v20）
   - 執行安裝程式，保持預設選項，確保勾選「Add to PATH」

2. **驗證安裝**（安裝完成後，**重新開啟 PowerShell**，然後執行）：
```powershell
node -v
npm -v
```
應該會顯示版本號（例如 v20.x.x 和 10.x.x）

### 步驟 2：安裝 Git

1. **下載 Git**
   - 訪問：https://git-scm.com/download/win
   - 下載 Windows 版本並執行安裝
   - 安裝時選項：
     - 預設編輯器可選 Vim 或 Notepad++
     - 勾選「Git from the command line and also from 3rd-party software」
     - 其他保持預設即可

2. **驗證安裝**（安裝完成後，**重新開啟 PowerShell**，然後執行）：
```powershell
git --version
```
應該會顯示版本號（例如 git version 2.x.x）

3. **設定 Git 使用者資訊**（首次使用 Git 必須設定）：
```powershell
git config --global user.name "你的名字"
git config --global user.email "你的GitHub郵箱"
```

---

## 本地安裝與測試

**重新開啟 PowerShell 後**（確保 node、npm、git 都可用），執行：

```powershell
cd Q:\pythoncode\Rachel
npm install
npm start
```

成功後訪問：
- 遊戲大廳：http://localhost:3000
- 後台管理：http://localhost:3000/admin.html

按 Ctrl+C 停止伺服器。

---

## 推送到 GitHub

### 步驟 1：在 GitHub 建立倉庫（如果還沒建立）

1. 登入 GitHub：https://github.com
2. 點擊右上角「+」→「New repository」
3. Repository name：`kids-learn-swift`
4. 選擇 Public 或 Private
5. **不要**勾選「Initialize this repository with a README」（因為我們本地已有檔案）
6. 點擊「Create repository」

### 步驟 2：推送本地專案到 GitHub

在 PowerShell 執行（請在 `Q:\pythoncode\Rachel` 目錄下）：

```powershell
# 初始化 Git 倉庫
git init

# 添加所有檔案
git add .

# 提交
git commit -m "Initial commit - 遊戲平台專案"

# 設定主分支名稱
git branch -M main

# 添加遠端倉庫（請確認這是你的 GitHub 用戶名和倉庫名）
git remote add origin https://github.com/FluffyFridgee/kids-learn-swift.git

# 推送到 GitHub
git push -u origin main
```

**注意**：第一次推送時，系統會要求你輸入 GitHub 認證：
- **用戶名**：你的 GitHub 用戶名
- **密碼**：不是你的密碼！而是 **Personal Access Token (PAT)**

### 步驟 3：建立 GitHub Personal Access Token（用於推送）

如果你還沒有 PAT：

1. 登入 GitHub
2. 右上角頭像 → Settings
3. 左側最下方 → Developer settings
4. Personal access tokens → Tokens (classic)
5. Generate new token (classic)
6. 設定：
   - Note：`Rachel Game Platform`
   - Expiration：選擇有效期限
   - 勾選 scopes：`repo`（完整的倉庫存取權限）
7. 點擊「Generate token」
8. **複製並保存 token**（只會顯示一次！）

當執行 `git push` 時：
- Username：輸入你的 GitHub 用戶名
- Password：**貼上剛才複製的 token**（不是你的 GitHub 密碼）

---

## 啟用 GitHub Pages（前端部署）

### 方法一：使用 GitHub Actions（自動化，推薦）

我已經在專案中加入 `.github/workflows/deploy_public.yml`，當你推送到 main 分支後：

1. 到 GitHub 倉庫頁面
2. 點擊「Actions」標籤
3. 等待 workflow 執行完成（綠色勾勾）
4. 到 Settings → Pages
5. 查看你的網站 URL（例如 `https://fluffyfridgee.github.io/kids-learn-swift/`）

### 方法二：手動設定 Pages

1. 到 GitHub 倉庫 → Settings → Pages
2. Source 選擇：
   - Branch: `gh-pages`（如果 Actions 成功執行後會自動建立）
   - 或選 `main` 分支的 `/public` 資料夾（若支援）
3. 儲存後等待幾分鐘，網站會發佈

---

## 後端部署選項

### 選項 A：Vercel（推薦，簡單快速）

1. **安裝 Vercel CLI**：
```powershell
npm install -g vercel
```

2. **登入並部署**：
```powershell
vercel login
cd Q:\pythoncode\Rachel
vercel --prod
```

3. **設定環境變數**（在 Vercel 網站或 CLI）：
   - `NODE_ENV=production`

4. **更新前端 API URL**：
   - 部署成功後會得到域名（例如 `https://your-app.vercel.app`）
   - 修改 `public/js/main.js` 的 `API_BASE_URL` 為：
     ```javascript
     const API_BASE_URL = 'https://your-app.vercel.app/api';
     ```

**重要**：Vercel 是 serverless，SQLite 不會持久化！建議改用雲端資料庫（見下方）。

### 選項 B：Heroku

1. **安裝 Heroku CLI**：https://devcenter.heroku.com/articles/heroku-cli

2. **部署**：
```powershell
heroku login
cd Q:\pythoncode\Rachel
heroku create your-app-name
git push heroku main
```

3. **加入 Postgres**：
```powershell
heroku addons:create heroku-postgresql:mini
```

4. **修改程式碼使用 Postgres**（需要修改 `database.js`）

### 選項 C：Render（推薦，有免費方案）

1. 到 https://render.com 註冊
2. 連接 GitHub 倉庫
3. 新增 Web Service
4. 設定：
   - Build Command: `npm install`
   - Start Command: `npm start`
   - 可加入免費 PostgreSQL 資料庫

---

## 生產環境注意事項

### 1. 資料庫問題
- **問題**：SQLite 在 serverless（Vercel）或分散式環境不可用
- **解決方案**：改用雲端資料庫
  - PostgreSQL（Heroku、Render、Supabase）
  - MongoDB Atlas（免費方案）
  - PlanetScale（MySQL）

### 2. 更新 API URL
前端需要知道後端位址。修改 `public/js/main.js` 和 `public/js/admin.js`：

```javascript
// 改為你的後端實際 URL
const API_BASE_URL = 'https://your-backend-url.vercel.app/api';
```

### 3. CORS 設定
`server.js` 已包含 `cors()`，但可以限制只允許特定網域：

```javascript
app.use(cors({
  origin: 'https://fluffyfridgee.github.io'
}));
```

### 4. 後台安全
目前 admin.html 沒有身份驗證！建議：
- 加入登入頁面
- 使用 JWT 或 session
- 或至少設定環境變數密碼

---

## 常見問題

### Q: npm/git 無法識別？
A: 安裝後必須**重新開啟 PowerShell**，並確保安裝時勾選了「Add to PATH」

### Q: git push 要求密碼但我的密碼不對？
A: GitHub 已不支援密碼，請使用 Personal Access Token（見上方步驟）

### Q: GitHub Pages 顯示 404？
A: 
1. 檢查 Settings → Pages 是否已啟用
2. 確認 Actions 是否執行成功
3. 網址是 `https://用戶名.github.io/倉庫名/`

### Q: 前端無法連接後端 API？
A: 
1. 檢查 `API_BASE_URL` 是否指向正確的後端網址
2. 確認後端已部署並運行
3. 檢查瀏覽器 Console 的 CORS 錯誤

### Q: Vercel 部署後資料消失？
A: Vercel 是 serverless，SQLite 不會保存。請改用雲端資料庫。

---

## 快速參考指令

### 本地開發
```powershell
npm install          # 安裝依賴
npm start           # 啟動伺服器
npm run dev         # 開發模式（自動重啟）
```

### Git 操作
```powershell
git status          # 查看狀態
git add .           # 添加所有更改
git commit -m "訊息"  # 提交
git push            # 推送到遠端
```

### 部署
```powershell
vercel --prod       # 部署到 Vercel
heroku logs --tail  # 查看 Heroku 日誌
```

---

## 需要幫助？

如果遇到問題，請提供：
1. 錯誤訊息的完整截圖
2. 你執行的命令
3. 你當前的步驟

我會協助你解決！
